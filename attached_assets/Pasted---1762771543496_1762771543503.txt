Зорилго

Хос/Баг бүрдүүлэхэд урилга явуулсны дараа “Хос бүрдүүлэх / Баг үүсгэх” товч идэвхгүй болно. Бүрэн зөвшөөрөл (жишээ: 3-аас 3) ирмэгц л албан ёсоор бүртгэгдсэн баг/хос үүснэ. Зөвшөөрөл дутуу үед UI дээр хүлээгдэж буй гишүүд болон хэд нь зөвшөөрсөн тоо тодорхой харагдана.

Шаардлага (AC)

Урилга илгээмэгц:

Товч → идэвхгүй (“Урилгууд явсан”)

Статус чип: 2/3 зөвшөөрсөн • 1 хүлээгдэж байна (реал-тайм эсвэл 15 сек тутам poll).

Үйлдлүүд: [Урилга дахин илгээх] [Гишүүн солих] [Бүдгэрүүлэн: Баг үүсгэх]

Бүрэн зөвшөөрөгдөөгүй байхад:

Албан ёсны баг/хос үүсгэхгүй; DB-д provisional_team бичлэг статустай хадгал.

Хуудас/инфокартанд: “Баг баталгаажаагүй (2/3). Сүүлд зөвшөөрсөн гишүүн: ХХ:YY.”

Бүх урилга зөвшөөрөгдмөгц:

provisional_team → confirmed_team атомик шилжилт.

Ногоон баннер: “Амжилттай! Баг бүртгэгдлээ.”

Оролцох төрлийн карт дээр ✓ Баг бүрдсэн тэмдэглэл.

Товчдыг солих дүрэм:

Pending үед: “Хос/Баг бүрдүүлэх” → “Зөвшөөрөл хүлээж байна” (идэвхгүй)

Хэрэглэгч өөр урилга илгээхээр дарахад: “Өмнөх урилга идэвхтэй байна” анхааруулга.

Цуцлах боломж: “Урилгыг цуцлах” → pending устгаад товчийг идэвхжүүл.

Backend (богино):

Модель: team_invite {provisional_id, tournament_id, event, inviter_id, invitee_id, status(pending|accepted|declined), expires_at}

Endpoint-ууд:

POST /provisional (урилга багц үүсгэх)

POST /provisional/:id/accept / decline

GET /provisional/:id/status (accepted_count / required_count, member_states[])

POST /provisional/:id/confirm (guard: accepted === required → official team create)

POST /provisional/:id/cancel

Guard: confirm зөвхөн accepted === required үед.

UI микро-копи

Pending: “Урилгууд илгээгдсэн. 2/3 зөвшөөрсөн — 1 гишүүн хүлээгдэж байна.”

Confirm: “Баг амжилттай бүртгэгдлээ.”

Decline: “Нэг гишүүн татгалзсан. Шинэ гишүүн сонгоно уу.”

Edge cases

Урилга дуусах хугацаа (ж: 24 цаг) → “Хугацаа дууссан — Урилгыг дахин илгээх”.

Давхар зөвшөөрөл → идемпотент confirm.

Өөр багт түгжээ: invitee аль хэдийн өөр багт батлагдсан бол сонголтод хаалт ба тайлбар.