Хос/Баг бүрдүүлэх хуудсын өгөгдөл, шүүлтүүр, шалгалтыг зөв ажиллуул
1) API ба өгөгдлийн гэрээ (server-side)

Эндпоинт: GET /api/registrations

Шаардлагатай query:

tournamentId (заавал)

event (заавал) — URL-ээр ирж буй eventType-ийн JSON-ыг server дээр parse хийж, KIND ба GENDER-ийг каноник болго.

Server-ийн шүүлтүүрийн дүрэм:

Зөвхөн тэр тэмцээний (tournamentId) тэр төрөлд (event) аль хэдийн бүртгүүлсэн тамирчдыг буцаа.

Каноникчлол:

KIND: TEAM | DOUBLES | SINGLES

GENDER: MEN | WOMEN | MIXED

subType байсан ч, type+genderReq байсан ч адилхан таньж шүүнэ (legacy-г дэмж).

Тухайн event-д аль хэдийн баг/хос бүрдүүлчихсэн тамирчдыг хас.

Одоогийн хэрэглэгчийг (request user) листээс хас (өөрийг нь дээд талын “Бүрэлдэхүүн” хэсэгт тусдаа харуулдаг).

q хайлтын параметр өгвөл нэрээр фильтрлэ (case-insensitive).

Буцах талбарууд (минимал): id, fullName, gender, club, rating, registrations[] (optional).

Аюулгүй байдал: Cookie-г шалгаж, зөвхөн энэ тэмцээний бүртгэлтэй жагсаалтыг буцаа.

Эндпоинт: POST /api/teams (эсвэл /api/pairs)

Бодлого хэвээр: “бүх гишүүд тухайн event-д бүртгэлтэй байх ёстой”.

Гэхдээ алдааны мессежийг тодорхой болго: аль гишүүн(үүд) бүртгэлгүй байгааг errors.missingMembers: [id...] хэлбэрээр буцаа.

Зорилго: Шүүлтүүрийг server-side дээр хийснээр UI дээр “хоосон” эсвэл “буруу хүмүүс” гарах эрсдэл арилна.

2) Клиентээс ирэх хүсэлтүүд (client-side policy)

Бүх fetch/Query-д credentials: 'include' хэрэглэ. (Cookie дамжуулахгүйгээс болж одоо хоосон жагсаалт бууж байна.)

Хуудас нээгдэхэд:

URL-ийн event параметрийг заавал шалга. Хэрвээ байхгүй/эвдэрхий бол айлгүй тайлбар харуулж, буцах товч өг.

Хайлт: 200–300ms debounce.

Хэрэглэгч өөрөө листэнд харагдах ёсгүй (self-exclude).

Аль хэдийн сонгосон гишүүд листнээс алга байх ёстой (already-selected exclude).

3) Каноникчлол (event normalize) — логик заавар

eventType JSON-оос дараахыг гарга:

KIND: TEAM | DOUBLES | SINGLES — subType эсвэл type-оос, uppercase, includes ашигла.

GENDER: MEN | WOMEN | MIXED — subType эсвэл genderReq/gender-оос, uppercase.

Дотоодод зөвхөн энэ 2-ыг түшиж шүүлт хийнэ. (“MEN_DOUBLES”, “WOMEN_TEAM” гэх мэт нэрэнд найдахгүй.)

4) Бизнес дүрэм (validation)

Баг: мин 3, макс 4 гишүүн (self + сонгосон).

Хос: яг 2 тамирчин (self + 1 хамтрагч).

Gender rule:

MEN → бүх гишүүн эрэгтэй

WOMEN → бүх гишүүн эмэгтэй

MIXED → хүйсийн зохицолтыг event-ийн дүрмээр (ерөнхийдөө холимог).

Server-ийн 400 ирвэл UI-д:

“Бүртгэлгүй гишүүн байна” + аль гишүүн гэдгийг шалтгаантай харуул.

5) UI/UX өөрчлөлт (код бичихгүй, зан үйл)

Хоосон жагсаалт үед:

Гарчиг: “Энэ төрөлд бүртгүүлсэн тамирчид олдсонгүй”

Тайлбар: “Та зөвхөн энэ төрөлд бүртгүүлсэн тамирчдаас сонгож болно.”

Сонгосон гишүүнийг устгах / солих үйлдэл заавал байхаар үлдээнэ.

Тоолуур:

Баг: (${current}/${max}) — self-ийг тооцож харуул.

Хос: (${currentPartnerCount}/1) — self-ийг тусад нь харуул.

Товч идэвхжих нөхцөл:

Нэр (багийн нэр) бөглөгдсөн

Гишүүдийн тоо зөв

Алдаа байхгүй

6) Диагностик / Тест (QA checklist)

Network: /api/registrations?tournamentId=…&event=… → 200, хоосон биш; Response-д зөвхөн тэр төрөлд бүртгэлтэй тамирчид байна.

Өөрийн нэр листэнд гарахгүй.

“Дан эрэгтэй хос” дээр эмэгтэй эсвэл singles/other event бүртгэлтэй хүмүүс гарч ирэх ёсгүй.

Аль хэдийн хостой/багтай нэг тамирчин → листэнд гарахгүй.

Багийн тоо: 2 хүн нэмэхэд “дутуу” алдаа, 5 хүн нэмэхэд “ихдэж байна” алдаа.

POST /api/teams|pairs амжилттай; буруу үед аль гишүүн шалтгаантай буцаагдана.

Хайлтаар нэрийн хэсгээр (case-insensitive) зөв шүүгдэж байна.

7) Алдаа гарсан байж болох үндсэн шалтгаан (одоо харагдаж буй)

Клиентээс /api/registrations руу cookie дамжуулаагүй → сервер хоосон/хязгаарлагдмал өгөгдөл буцаасан.

Server шүүлтүүр тэмцээний төрөлд (event) суурилдаггүй → бүх бүртгэлтэй хүмүүсийг буцаасан (өмнөх асуудалтай дүйцнэ).

Event parse логик адилгүй формат-уудыг хамарч чадаагүй → “ямар ч тохирох хүн алга” мэт болж, UI-д хоосон харагдсан.

8) Done-ийн шалгуур (Definition of Done)

“Дан эрэгтэй хос” дээр зөвхөн энэ төрөлд бүртгэлтэй эрэгтэй тамирчид гарна.

Өөрийн нэр листэд огт гарахгүй.

Баг 3–4, хос 2 дүрэм хатуу мөрдөгдөнө.

Аль хэдийн бүрдүүлсэн (team/pair assigned) тамирчид гарч ирэхгүй.

API-ийн 400 мессеж шалтгаантай, ойлгомжтой.

Хайлтын шүүлтүүр зөв ажиллана, хоосон үед copy зөв гарна.